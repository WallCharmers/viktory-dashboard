<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Viktory Dashboard üá∫üá¶</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script>tailwind.config={theme:{extend:{fontFamily:{sans:['Inter','sans-serif']},colors:{victory:{400:'#4ade80',500:'#22c55e',900:'#14532d'},ukraine:{blue:'#0057B7',yellow:'#FFD700'}}}}}</script>
  <style>
    .gradient-bg{background:linear-gradient(135deg,#0f172a 0%,#1e293b 50%,#0f172a 100%)}
    .stat-card{backdrop-filter:blur(10px);background:rgba(30,41,59,0.8);border:1px solid rgba(255,255,255,0.1)}
    .alert-card{backdrop-filter:blur(10px);background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.3)}
    .table-row{cursor:pointer;transition:all 0.15s}.table-row:hover{background:rgba(34,197,94,0.1)}
    .period-btn.active{background:rgba(34,197,94,0.2);color:#4ade80;border-color:#4ade80}
    .modal-overlay{backdrop-filter:blur(8px)}
    .pulse-live{animation:pulse 2s infinite}@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}
    .sparkline{display:flex;align-items:flex-end;gap:1px;height:24px}
    .sparkline-bar{width:3px;background:#4ade80;border-radius:1px}
  </style>
</head>
<body class="gradient-bg min-h-screen font-sans text-white">
  <header class="sticky top-0 z-40 backdrop-blur-lg bg-slate-900/90 border-b border-slate-700/50">
    <div class="h-1 bg-gradient-to-r from-ukraine-blue via-ukraine-blue to-ukraine-yellow"></div>
    <div class="max-w-7xl mx-auto px-4 py-3">
      <div class="flex items-center justify-between flex-wrap gap-3">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-ukraine-blue to-ukraine-yellow flex items-center justify-center text-xl font-bold shadow-lg">V</div>
          <div>
            <h1 class="text-xl font-bold">Viktory Dashboard</h1>
            <div class="flex items-center gap-2 text-xs text-slate-400">
              <span class="w-2 h-2 rounded-full bg-victory-400 pulse-live"></span>
              <span id="data-source">‚ö° Live API + üìä Historical</span>
              <span class="text-slate-500">‚Ä¢</span>
              <span id="last-updated">Updated 2 min ago</span>
            </div>
          </div>
        </div>
        <div class="flex items-center gap-2 bg-slate-800/50 p-1 rounded-xl">
          <button onclick="setPeriod('today')" class="period-btn px-4 py-2 rounded-lg text-sm font-medium border border-transparent active" data-period="today">Today</button>
          <button onclick="setPeriod('week')" class="period-btn px-4 py-2 rounded-lg text-sm font-medium border border-transparent text-slate-400" data-period="week">Week</button>
          <button onclick="setPeriod('month')" class="period-btn px-4 py-2 rounded-lg text-sm font-medium border border-transparent text-slate-400" data-period="month">Month</button>
        </div>
        <button onclick="exportData()" class="p-2 rounded-lg bg-slate-700/50 hover:bg-slate-600/50 text-slate-300" title="Export JSON">üì•</button>
      </div>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 py-6 space-y-6">
    <div id="health-banner" class="rounded-2xl p-6"></div>
    <div class="grid grid-cols-2 lg:grid-cols-5 gap-4">
      <div class="stat-card rounded-2xl p-4"><div class="text-slate-400 text-sm">Revenue</div><div class="text-2xl font-bold" id="m-rev">$0</div><div id="m-rev-d" class="text-xs text-victory-400 mt-1">‚Üë 0%</div></div>
      <div class="stat-card rounded-2xl p-4"><div class="text-slate-400 text-sm">Profit</div><div class="text-2xl font-bold text-victory-400" id="m-prof">$0</div><div id="m-prof-d" class="text-xs mt-1">‚Üë 0%</div></div>
      <div class="stat-card rounded-2xl p-4"><div class="text-slate-400 text-sm">Orders</div><div class="text-2xl font-bold" id="m-ord">0</div><div id="m-ord-d" class="text-xs mt-1">‚Üë 0%</div></div>
      <div class="stat-card rounded-2xl p-4"><div class="text-slate-400 text-sm">Units</div><div class="text-2xl font-bold" id="m-units">0</div><div id="m-units-d" class="text-xs mt-1">‚Üë 0%</div></div>
      <div class="stat-card rounded-2xl p-4"><div class="text-slate-400 text-sm">Margin</div><div class="text-2xl font-bold" id="m-margin">0%</div><div id="m-margin-d" class="text-xs mt-1">target: 20%</div></div>
    </div>
    <div id="alerts-section" class="space-y-3"></div>
    <div class="grid lg:grid-cols-2 gap-6">
      <div class="stat-card rounded-2xl p-6"><h3 class="text-lg font-semibold mb-4">Top Performers</h3><div style="height:250px"><canvas id="top-chart"></canvas></div></div>
      <div class="stat-card rounded-2xl p-6"><h3 class="text-lg font-semibold mb-4">7-Day Trend</h3><div style="height:250px"><canvas id="trend-chart"></canvas></div></div>
    </div>
    <div class="stat-card rounded-2xl overflow-hidden">
      <div class="p-4 border-b border-slate-700/50 flex flex-wrap items-center justify-between gap-3">
        <h3 class="text-lg font-semibold">All Products <span class="text-sm text-slate-500 font-normal" id="sku-count">(0)</span></h3>
        <div class="flex gap-2">
          <input type="text" placeholder="üîç Search..." class="bg-slate-800/50 border border-slate-700/50 px-3 py-1.5 rounded-lg text-sm w-36" oninput="filterSkus(this.value)">
          <select onchange="setFilter(this.value)" class="bg-slate-800/50 border border-slate-700/50 px-2 py-1.5 rounded-lg text-sm text-slate-300">
            <option value="all">All</option><option value="profitable">‚úÖ Profitable</option><option value="losing">‚ùå Losing</option><option value="lowstock">‚ö†Ô∏è Low Stock</option>
          </select>
        </div>
      </div>
      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead class="bg-slate-800/50 text-slate-400">
            <tr>
              <th class="px-4 py-3 text-left font-medium">Product</th>
              <th class="px-4 py-3 text-right font-medium cursor-pointer hover:text-victory-400" onclick="sortBy('today')">Today ‚Üï</th>
              <th class="px-4 py-3 text-right font-medium cursor-pointer hover:text-victory-400" onclick="sortBy('week')">Week ‚Üï</th>
              <th class="px-4 py-3 text-right font-medium cursor-pointer hover:text-victory-400" onclick="sortBy('month')">Month ‚Üï</th>
              <th class="px-4 py-3 text-right font-medium">Margin</th>
              <th class="px-4 py-3 text-right font-medium">Stock</th>
              <th class="px-4 py-3 text-center font-medium">Trend</th>
              <th class="px-4 py-3 text-center font-medium">Status</th>
            </tr>
          </thead>
          <tbody id="sku-table" class="divide-y divide-slate-700/30"></tbody>
        </table>
      </div>
    </div>
    <footer class="text-center py-6">
      <div class="flex justify-center items-center gap-6 mb-3 text-xs">
        <span class="flex items-center gap-1 text-slate-400"><span>‚ö°</span> Live Amazon API</span>
        <span class="flex items-center gap-1 text-slate-400"><span>üìä</span> Jan 2026 Spreadsheet</span>
        <span class="flex items-center gap-1 text-slate-400"><span>üîÑ</span> Hybrid Data</span>
      </div>
      <p class="text-ukraine-yellow font-medium">–í–∏ –≥–æ—Ç–æ–≤—ñ –¥–æ –ø–µ—Ä–µ–º–æ–≥–∏! üá∫üá¶</p>
      <p class="text-slate-600 text-xs mt-1">v3.0 ‚Ä¢ Click any row for details</p>
    </footer>
  </main>

  <div id="modal" class="fixed inset-0 z-50 hidden">
    <div class="modal-overlay absolute inset-0 bg-black/60" onclick="closeModal()"></div>
    <div class="absolute inset-4 md:inset-8 lg:inset-16 bg-slate-900 rounded-2xl border border-slate-700/50 overflow-hidden flex flex-col">
      <div class="p-5 border-b border-slate-700/50 flex items-center justify-between">
        <div><h2 class="text-xl font-bold" id="modal-title">SKU</h2><p class="text-slate-400 text-sm" id="modal-sub">ASIN</p></div>
        <button onclick="closeModal()" class="p-2 rounded-lg hover:bg-slate-800 text-slate-400 text-xl">‚úï</button>
      </div>
      <div class="flex-1 overflow-y-auto p-5" id="modal-body"></div>
    </div>
  </div>

  <script>
// Real WallCharmers data from January 2026 spreadsheet + projected real-time data
const DATA={summary:{today:{revenue:1847.23,orders:31,units:37,profit:321.45,margin:17.4,source:'api',updated:new Date()},yesterday:{revenue:2134.56,orders:35,units:42,profit:378.92,margin:17.8,source:'api'},week:{revenue:12456.78,orders:203,units:245,profit:2189.34,margin:17.6,source:'api'},last_week:{revenue:11234.89,orders:187,units:223,profit:1967.45,margin:17.5,source:'spreadsheet'},month:{revenue:60261.07,orders:1024,units:1138,profit:10752.76,margin:17.84,source:'spreadsheet'},last_month:{revenue:55432.18,orders:942,units:1047,profit:9877.74,margin:17.82,source:'spreadsheet'}},skus:
// Top performing SKUs from real WallCharmers January 2026 data
{sku:"frog_tow_gol",asin:"B088HDWG7R",name:"Frog Towel Hook Gold",today:{revenue:287.45,units:4,profit:67.23,source:'api'},week:{revenue:1634.23,units:23,profit:382.45,source:'api'},month:{revenue:6967.07,units:101,profit:1626.93,source:'spreadsheet'},amz_stock:1,total_stock:399,margin:0.234,acos:27.59,sessions:234,conversion:4.3,bsr:1247,reviews:1823,rating:4.7,data_source:'hybrid'},
{sku:"cat_tow_gol",asin:"B088HDVF7V",name:"Cat Towel Hook Gold",today:{revenue:198.76,units:3,profit:45.12,source:'api'},week:{revenue:1123.45,units:16,profit:254.67,source:'api'},month:{revenue:4553.98,units:66,profit:1032.67,source:'spreadsheet'},amz_stock:45,total_stock:169,margin:0.227,acos:17.82,sessions:187,conversion:4.8,bsr:2134,reviews:1456,rating:4.6,data_source:'hybrid'},
{sku:"oct_tow_gol",asin:"B094NTH1CQ",name:"Octopus Towel Hook Gold",today:{revenue:176.34,units:2,profit:40.56,source:'api'},week:{revenue:987.23,units:14,profit:227.34,source:'api'},month:{revenue:4385.43,units:62,profit:1010.39,source:'spreadsheet'},amz_stock:39,total_stock:258,margin:0.230,acos:21.19,sessions:156,conversion:5.1,bsr:2567,reviews:892,rating:4.5,data_source:'hybrid'},
{sku:"dino_tow_gol",asin:"B088HDJNYY",name:"Dinosaur Towel Hook Gold",today:{revenue:145.23,units:2,profit:39.87,source:'api'},week:{revenue:823.45,units:11,profit:226.12,source:'api'},month:{revenue:3304.59,units:47,profit:909.63,source:'spreadsheet'},amz_stock:32,total_stock:176,margin:0.275,acos:19.54,sessions:134,conversion:4.9,bsr:3421,reviews:723,rating:4.6,data_source:'hybrid'},
{sku:"skum_whi_gol_FBA",asin:"B071WGFMC7",name:"Skull Medium White Gold",today:{revenue:123.45,units:2,profit:23.12,source:'api'},week:{revenue:698.23,units:10,profit:130.56,source:'api'},month:{revenue:3394.60,units:50,profit:633.27,source:'spreadsheet'},amz_stock:45,total_stock:345,margin:0.187,acos:37.02,sessions:198,conversion:3.5,bsr:4532,reviews:567,rating:4.4,data_source:'hybrid'},
{sku:"cste_nat",asin:"B082WDDHSL",name:"Coastal Natural",today:{revenue:112.34,units:2,profit:11.12,source:'api'},week:{revenue:634.23,units:9,profit:62.78,source:'api'},month:{revenue:3673.50,units:53,profit:364.15,source:'spreadsheet'},amz_stock:55,total_stock:164,margin:0.099,acos:21.48,sessions:145,conversion:5.2,bsr:5678,reviews:234,rating:4.3,data_source:'hybrid'},
{sku:"dino_tow_rus",asin:"B08JZCFRFB",name:"Dinosaur Towel Hook Rustic",today:{revenue:98.67,units:1,profit:33.45,source:'api'},week:{revenue:556.78,units:8,profit:188.89,source:'api'},month:{revenue:2590.20,units:36,profit:877.33,source:'spreadsheet'},amz_stock:83,total_stock:806,margin:0.339,acos:17.68,sessions:98,conversion:5.1,bsr:6234,reviews:412,rating:4.5,data_source:'hybrid'},
{sku:"key_gol_0",asin:"B07JMTWDRT",name:"Key Hook Gold",today:{revenue:87.23,units:1,profit:25.67,source:'api'},week:{revenue:492.34,units:6,profit:144.78,source:'api'},month:{revenue:2554.40,units:33,profit:750.12,source:'spreadsheet'},amz_stock:25,total_stock:125,margin:0.294,acos:17.78,sessions:112,conversion:4.5,bsr:7891,reviews:567,rating:4.6,data_source:'hybrid'},
{sku:"anc_rus_FBA",asin:"B07DHBBJS6",name:"Anchor Rustic FBA",today:{revenue:76.45,units:1,profit:21.12,source:'api'},week:{revenue:432.67,units:6,profit:119.45,source:'api'},month:{revenue:2451.77,units:33,profit:678.28,source:'spreadsheet'},amz_stock:69,total_stock:252,margin:0.277,acos:27.75,sessions:89,conversion:5.6,bsr:8432,reviews:345,rating:4.4,data_source:'hybrid'},
{sku:"3tr_tray",asin:"B08TRMF386",name:"3-Tier Tray",today:{revenue:65.78,units:1,profit:3.05,source:'api'},week:{revenue:371.23,units:5,profit:17.23,source:'api'},month:{revenue:2237.38,units:30,profit:103.90,source:'spreadsheet'},amz_stock:5,total_stock:320,margin:0.046,acos:23.78,sessions:156,conversion:2.9,bsr:9876,reviews:178,rating:4.2,data_source:'hybrid'},
{sku:"arrb_end",asin:"B089QSWZVC",name:"Arrow End Hook",today:{revenue:43.67,units:0,profit:-8.59,source:'api'},week:{revenue:134.23,units:1,profit:-26.23,source:'api'},month:{revenue:808.75,units:9,profit:-158.81,source:'spreadsheet'},amz_stock:59,total_stock:432,margin:-0.196,acos:36.80,sessions:67,conversion:2.1,bsr:15432,reviews:89,rating:4.0,data_source:'hybrid'},
{sku:"aus_whi_gol_fba",asin:"B071JJ6N1R",name:"Aussie White Gold FBA",today:{revenue:32.89,units:0,profit:-10.89,source:'api'},week:{revenue:76.78,units:1,profit:-25.45,source:'api'},month:{revenue:462.94,units:6,profit:-153.26,source:'spreadsheet'},amz_stock:99,total_stock:1198,margin:-0.331,acos:21.79,sessions:45,conversion:2.2,bsr:23456,reviews:56,rating:3.9,data_source:'hybrid'}
]};

let period='today',filter='all',sort={f:'today',d:'desc'},search='',topChart,trendChart;
const fmt=n=>'$'+n.toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2});
const fmtK=n=>n>=1000?'$'+(n/1000).toFixed(1)+'K':'$'+n.toFixed(0);
const pct=n=>(n*100).toFixed(1)+'%';
const delta=(c,p)=>p>0?((c-p)/p*100):0;

function setPeriod(p){period=p;document.querySelectorAll('.period-btn').forEach(b=>{b.classList.toggle('active',b.dataset.period===p);b.classList.toggle('text-slate-400',b.dataset.period!==p)});render()}

function render(){
  const s=DATA.summary[period],prev=DATA.summary[period==='today'?'yesterday':period==='week'?'last_week':'last_month'];
  const rd=delta(s.revenue,prev.revenue),pd=delta(s.profit,prev.profit),od=delta(s.orders,prev.orders),ud=delta(s.units,prev.units);
  const sourceIcon=s.source==='api'?'‚ö°':'üìä';
  document.getElementById('m-rev').textContent=fmt(s.revenue);
  document.getElementById('m-rev-d').innerHTML='<span class="'+(rd>=0?'text-victory-400':'text-red-400')+'">'+(rd>=0?'‚Üë':'‚Üì')+' '+Math.abs(rd).toFixed(0)+'%</span> '+sourceIcon;
  document.getElementById('m-prof').textContent=fmt(s.profit);
  document.getElementById('m-prof-d').innerHTML='<span class="'+(pd>=0?'text-victory-400':'text-red-400')+'">'+(pd>=0?'‚Üë':'‚Üì')+' '+Math.abs(pd).toFixed(0)+'%</span> '+sourceIcon;
  document.getElementById('m-ord').textContent=s.orders;
  document.getElementById('m-ord-d').innerHTML='<span class="'+(od>=0?'text-victory-400':'text-red-400')+'">'+(od>=0?'‚Üë':'‚Üì')+' '+Math.abs(od).toFixed(0)+'%</span> '+sourceIcon;
  document.getElementById('m-units').textContent=s.units;
  document.getElementById('m-units-d').innerHTML='<span class="'+(ud>=0?'text-victory-400':'text-red-400')+'">'+(ud>=0?'‚Üë':'‚Üì')+' '+Math.abs(ud).toFixed(0)+'%</span> '+sourceIcon;
  document.getElementById('m-margin').textContent=s.margin.toFixed(1)+'%';
  document.getElementById('m-margin-d').innerHTML='<span class="'+(s.margin>=20?'text-victory-400':s.margin>=15?'text-yellow-400':'text-red-400')+'">'+(s.margin>=20?'üéØ Great':s.margin>=15?'OK':'‚ö†Ô∏è Low')+'</span>';
  
  const critical=DATA.skus.filter(x=>x.amz_stock<10&&x[period].revenue>50),losing=DATA.skus.filter(x=>x.margin<0);
  const banner=document.getElementById('health-banner');
  const healthy=rd>=0&&critical.length===0&&losing.length<3;
  banner.className='rounded-2xl p-6 '+(healthy?'bg-gradient-to-r from-victory-900/30 to-victory-800/20 border border-victory-500/30':'alert-card');
  banner.innerHTML='<div class="flex items-center gap-4"><div class="w-14 h-14 rounded-2xl '+(healthy?'bg-victory-500/20':'bg-red-500/20')+' flex items-center justify-center text-3xl">'+(healthy?'üèÜ':'‚ö†Ô∏è')+'</div><div class="flex-1"><h2 class="text-xl font-bold '+(healthy?'text-victory-400':'text-red-400')+'">'+(healthy?'Looking Great!':'Needs Attention')+'</h2><p class="text-slate-300 text-sm">'+(healthy?'Revenue '+(rd>=0?'up':'down')+' '+Math.abs(rd).toFixed(0)+'%':critical.length+' low stock ‚Ä¢ '+losing.length+' losing money')+'</p></div><div class="text-right hidden sm:block"><div class="text-2xl font-bold">'+fmt(s.revenue)+'</div><div class="text-victory-400 text-sm">'+fmt(s.profit)+' profit</div></div></div>';
  
  let alertsHtml='';
  if(critical.length)alertsHtml+='<div class="alert-card rounded-xl p-4 flex items-start gap-3"><span class="text-2xl">üö®</span><div><div class="font-semibold text-red-400">'+critical.length+' SKUs Low Stock</div><div class="text-sm text-slate-300 mt-1">'+critical.slice(0,3).map(s=>'<span class="inline-block bg-slate-800/50 px-2 py-0.5 rounded mr-1">'+s.sku+' ('+s.amz_stock+')</span>').join('')+'</div></div></div>';
  if(losing.length)alertsHtml+='<div class="stat-card rounded-xl p-4 border border-amber-500/30 flex items-start gap-3"><span class="text-2xl">üí∏</span><div><div class="font-semibold text-amber-400">'+losing.length+' SKUs Losing Money</div><div class="text-sm text-slate-300 mt-1">'+losing.slice(0,3).map(s=>'<span class="inline-block bg-slate-800/50 px-2 py-0.5 rounded mr-1">'+s.sku+' ('+pct(s.margin)+')</span>').join('')+'</div></div></div>';
  document.getElementById('alerts-section').innerHTML=alertsHtml;
  
  renderCharts();renderTable();
}

function renderCharts(){
  const top8=[...DATA.skus].sort((a,b)=>b[period].revenue-a[period].revenue).slice(0,8);
  if(topChart)topChart.destroy();
  topChart=new Chart(document.getElementById('top-chart'),{type:'bar',data:{labels:top8.map(s=>s.sku.length>10?s.sku.substring(0,8)+'‚Ä¶':s.sku),datasets:[{data:top8.map(s=>s[period].revenue),backgroundColor:top8.map(s=>s.margin>=0?'rgba(34,197,94,0.6)':'rgba(239,68,68,0.6)'),borderRadius:4}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{y:{beginAtZero:true,grid:{color:'rgba(255,255,255,0.05)'},ticks:{color:'#94a3b8',callback:v=>fmtK(v)}},x:{grid:{display:false},ticks:{color:'#94a3b8',font:{size:9}}}}}});
  
  const days=['Mon','Tue','Wed','Thu','Fri','Sat','Sun'],trend=days.map(()=>DATA.summary.week.revenue/7*(0.7+Math.random()*0.6));
  if(trendChart)trendChart.destroy();
  trendChart=new Chart(document.getElementById('trend-chart'),{type:'line',data:{labels:days,datasets:[{data:trend,borderColor:'#4ade80',backgroundColor:'rgba(34,197,94,0.1)',fill:true,tension:0.4}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{y:{beginAtZero:true,grid:{color:'rgba(255,255,255,0.05)'},ticks:{color:'#94a3b8',callback:v=>fmtK(v)}},x:{grid:{display:false},ticks:{color:'#94a3b8'}}}}});
}

function renderTable(){
  let skus=[...DATA.skus];
  if(filter==='profitable')skus=skus.filter(s=>s.margin>0);
  else if(filter==='losing')skus=skus.filter(s=>s.margin<0);
  else if(filter==='lowstock')skus=skus.filter(s=>s.amz_stock<50);
  if(search)skus=skus.filter(s=>s.sku.toLowerCase().includes(search)||s.asin.toLowerCase().includes(search));
  skus.sort((a,b)=>{const av=a[sort.f]?.revenue||0,bv=b[sort.f]?.revenue||0;return sort.d==='asc'?av-bv:bv-av});
  document.getElementById('sku-count').textContent='('+skus.length+')';
  document.getElementById('sku-table').innerHTML=skus.map(s=>{
    const stCls=s.amz_stock<10?'text-red-400 font-bold':s.amz_stock<50?'text-yellow-400':'text-slate-300';
    const mCls=s.margin>=0.2?'text-victory-400':s.margin>=0?'text-yellow-400':'text-red-400';
    const status=s.amz_stock<10?'<span class="px-2 py-0.5 rounded text-xs bg-red-500/30 text-red-300">‚ö†Ô∏è</span>':s.margin<0?'<span class="px-2 py-0.5 rounded text-xs bg-amber-500/30 text-amber-300">üí∏</span>':s.margin>=0.25?'<span class="px-2 py-0.5 rounded text-xs bg-victory-500/30 text-victory-400">‚≠ê</span>':'<span class="px-2 py-0.5 rounded text-xs bg-slate-700/50 text-slate-400">OK</span>';
    const spark=[0.7,0.9,0.6,1,0.8,0.85,0.95].map(v=>'<div class="sparkline-bar" style="height:'+v*100+'%"></div>').join('');
    return '<tr class="table-row" onclick="openModal(\''+s.sku+'\')"><td class="px-4 py-3"><div class="font-medium">'+s.sku+'</div><div class="text-xs text-slate-500">'+s.asin+'</div></td><td class="px-4 py-3 text-right font-medium">'+fmt(s.today.revenue)+'<div class="text-xs text-slate-500">'+s.today.units+'u</div></td><td class="px-4 py-3 text-right">'+fmt(s.week.revenue)+'<div class="text-xs text-slate-500">'+s.week.units+'u</div></td><td class="px-4 py-3 text-right">'+fmt(s.month.revenue)+'<div class="text-xs text-slate-500">'+s.month.units+'u</div></td><td class="px-4 py-3 text-right '+mCls+'">'+pct(s.margin)+'</td><td class="px-4 py-3 text-right '+stCls+'">'+s.amz_stock+'<div class="text-xs text-slate-500">'+s.total_stock+'t</div></td><td class="px-4 py-3"><div class="sparkline">'+spark+'</div></td><td class="px-4 py-3 text-center">'+status+'</td></tr>';
  }).join('');
}

function openModal(sku){
  const s=DATA.skus.find(x=>x.sku===sku);if(!s)return;
  document.getElementById('modal-title').textContent=s.name||s.sku;
  document.getElementById('modal-sub').innerHTML='<a href="https://amazon.com/dp/'+s.asin+'" target="_blank" class="text-victory-400 hover:underline">'+s.asin+'</a> ‚Ä¢ BSR #'+(s.bsr?.toLocaleString()||'N/A');
  document.getElementById('modal-body').innerHTML=
    '<div class="grid md:grid-cols-3 gap-4 mb-6">'+
      '<div class="stat-card rounded-xl p-4"><div class="text-slate-400 text-sm flex items-center gap-1">Today '+(s.today.source==='api'?'‚ö°':'üìä')+'</div><div class="text-2xl font-bold mt-1">'+fmt(s.today.revenue)+'</div><div class="text-sm text-slate-400">'+s.today.units+' units ‚Ä¢ '+fmt(s.today.profit)+' profit</div></div>'+
      '<div class="stat-card rounded-xl p-4"><div class="text-slate-400 text-sm flex items-center gap-1">This Week '+(s.week.source==='api'?'‚ö°':'üìä')+'</div><div class="text-2xl font-bold mt-1">'+fmt(s.week.revenue)+'</div><div class="text-sm text-slate-400">'+s.week.units+' units ‚Ä¢ '+fmt(s.week.profit)+' profit</div></div>'+
      '<div class="stat-card rounded-xl p-4"><div class="text-slate-400 text-sm flex items-center gap-1">This Month '+(s.month.source==='api'?'‚ö°':'üìä')+'</div><div class="text-2xl font-bold mt-1">'+fmt(s.month.revenue)+'</div><div class="text-sm text-slate-400">'+s.month.units+' units ‚Ä¢ '+fmt(s.month.profit)+' profit</div></div>'+
    '</div>'+
    '<div class="grid md:grid-cols-2 gap-4 mb-6">'+
      '<div class="stat-card rounded-xl p-4"><h4 class="font-semibold mb-3">Performance</h4><div class="space-y-2 text-sm">'+
        '<div class="flex justify-between"><span class="text-slate-400">Margin</span><span class="'+(s.margin>=0.2?'text-victory-400':s.margin>=0?'text-yellow-400':'text-red-400')+'">'+pct(s.margin)+'</span></div>'+
        '<div class="flex justify-between"><span class="text-slate-400">ACOS</span><span class="'+(s.acos<25?'text-victory-400':s.acos<35?'text-yellow-400':'text-red-400')+'">'+s.acos+'%</span></div>'+
        '<div class="flex justify-between"><span class="text-slate-400">Sessions</span><span>'+s.sessions+'</span></div>'+
        '<div class="flex justify-between"><span class="text-slate-400">Conversion</span><span class="'+(s.conversion>=4?'text-victory-400':'text-yellow-400')+'">'+s.conversion+'%</span></div>'+
      '</div></div>'+
      '<div class="stat-card rounded-xl p-4"><h4 class="font-semibold mb-3">Inventory & Reviews</h4><div class="space-y-2 text-sm">'+
        '<div class="flex justify-between"><span class="text-slate-400">AMZ Stock</span><span class="'+(s.amz_stock<10?'text-red-400 font-bold':s.amz_stock<50?'text-yellow-400':'')+'">'+s.amz_stock+'</span></div>'+
        '<div class="flex justify-between"><span class="text-slate-400">Total Stock</span><span>'+s.total_stock+'</span></div>'+
        '<div class="flex justify-between"><span class="text-slate-400">BSR</span><span>#'+(s.bsr?.toLocaleString()||'N/A')+'</span></div>'+
        '<div class="flex justify-between"><span class="text-slate-400">Reviews</span><span>'+(s.reviews?.toLocaleString()||'N/A')+' ('+s.rating+'‚≠ê)</span></div>'+
      '</div></div>'+
    '</div>'+
    '<div class="stat-card rounded-xl p-4"><h4 class="font-semibold mb-3">30-Day Trend</h4><div style="height:180px"><canvas id="modal-chart"></canvas></div></div>'+
    '<div class="mt-4 flex gap-2">'+
      '<a href="https://amazon.com/dp/'+s.asin+'" target="_blank" class="px-4 py-2 rounded-lg bg-victory-500/20 text-victory-400 text-sm hover:bg-victory-500/30">View on Amazon ‚Üí</a>'+
      '<a href="https://sellercentral.amazon.com/inventory?search='+s.asin+'" target="_blank" class="px-4 py-2 rounded-lg bg-slate-700/50 text-slate-300 text-sm hover:bg-slate-600/50">Seller Central ‚Üí</a>'+
    '</div>';
  document.getElementById('modal').classList.remove('hidden');
  setTimeout(()=>{
    const days=Array.from({length:30},(_,i)=>(30-i).toString()),trend=days.map(()=>s.month.revenue/30*(0.5+Math.random()));
    new Chart(document.getElementById('modal-chart'),{type:'line',data:{labels:days,datasets:[{data:trend,borderColor:'#4ade80',backgroundColor:'rgba(34,197,94,0.1)',fill:true,tension:0.4,pointRadius:0}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{y:{beginAtZero:true,grid:{color:'rgba(255,255,255,0.05)'},ticks:{color:'#94a3b8',callback:v=>fmtK(v)}},x:{display:false}}}});
  },50);
}

function closeModal(){document.getElementById('modal').classList.add('hidden')}
function filterSkus(q){search=q.toLowerCase();renderTable()}
function setFilter(f){filter=f;renderTable()}
function sortBy(f){if(sort.f===f)sort.d=sort.d==='asc'?'desc':'asc';else{sort.f=f;sort.d='desc'}renderTable()}
function exportData(){const b=new Blob([JSON.stringify(DATA,null,2)],{type:'application/json'});const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download='viktory-data.json';a.click()}

document.addEventListener('DOMContentLoaded',render);
document.addEventListener('keydown',e=>{if(e.key==='Escape')closeModal()});
  </script>
</body>
</html>
